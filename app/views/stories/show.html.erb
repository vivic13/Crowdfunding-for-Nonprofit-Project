<div class="container text-center">
	<h1>故事內容</h1>
</div>
<div class="container">
	<% if current_user.present? %>
		<% if @story.already_liked(current_user) %>      
      <%= button_to  unlike_story_path(@story), {:remote => true} do %>
      		<i class="fa fa-heart fa-2x" aria-hidden="true"><%= @story.like_count %></i>
			<%end %>
    <%else%>      
      <%= button_to like_story_path(@story) , {:remote => true} do%>
      	<i class="fa fa-heart-o fa-2x" aria-hidden="true"><%= @story.like_count %>
      	</i>
      <%end%>
    <% end %>
  <% else %>
		<i class="fa fa-heart-o fa-2x" aria-hidden="true"><%= @story.like_count %> <small>登入按讚</small>
    </i>
  <% end %>
</div>

<div class="container">
	<p>標題: <%= @story.title %></p>
	<p>內容: <%= @story.content %></p>
	
</div>

<% if @photos.present? %>
  <div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
      <% @photos.each_with_index do |outing, i| %>
        <li data-target="#mycarousel" data-slide-to=#{i} class="#{'active' if i == 0}"></li>
      <% end %>
    </ol>
    <!-- Wrapper for slides -->
    <div class="carousel-inner">
      <div class="item active">
        <%= link_to image_tag(@photos.first.image.url)%>
      </div>
      <% if @photos_count >= 1 %>       
        <% @story.photofiles.drop(1).each do |p| %>
          <div class="item">
            <%= link_to image_tag(p.image.url)%>
          </div>
        <% end %>
      <% end %>      
    </div>

    <!-- Left and right controls -->
    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
      <span class="glyphicon glyphicon-chevron-left"></span>
      
    </a>
    <a class="right carousel-control" href="#myCarousel" data-slide="next">
      <span class="glyphicon glyphicon-chevron-right"></span>
     
    </a>
  </div>
<% else %>
  <iframe id="ytplayer" type="text/html" width="640" height="360" src= "<%= @link %>" frameborder="0"></iframe>
<% end %>

<div class="container">   

  <% if current_user %>
  <hr>
    <div class="container">
      <h3>目前:<span id="count"><%= @comment_no %></span> 則留言<i class="fa fa-commenting" aria-hidden="true"></i></h3>

      
      <%= render :partial => 'story_comments/form' %>
    </div>
      <div class="container" id="comment-list">
        <% @comments.each do |c| %>
          <%= render :partial => 'story_comments/comment', :locals => {:c => c }%>
          
        <% end %>

      </div>

      <% paginate @comments %>

      
      <% if @next_page %>
        <%= link_to '更多留言',story_path(@story, :page => @next_page) ,:id => 'load-more',:remote => true %>
      <% end %>
<% else %>

  <h3>登入就可觀看留言</h3>
 <% end %>
  <%#= render 'disqus'%>
</div>

<script>
  // Load the IFrame Player API code asynchronously.
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/player_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // Replace the 'ytplayer' element with an <iframe> and
  // YouTube player after the API code downloads.
  var player;
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('ytplayer', {
      height: '360',
      width: '640',
      videoId: 'M7lc1UVf-VE'
    });
  }
</script>
